<h1 id="xlsx">xlsx</h1>
<p>Parser and writer for various spreadsheet formats. Pure-JS cleanroom implementation from official specifications, related documents, and test files. Emphasis on parsing and writing robustness, cross-format feature compatibility with a unified JS representation, and ES3/ES5 browser compatibility back to IE6.</p>
<p>File format support for known spreadsheet data formats:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Format</th>
<th style="text-align: center;">Read</th>
<th style="text-align: center;">Write</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Excel Worksheet/Workbook Formats</strong></td>
<td style="text-align: center;">:—–:</td>
<td style="text-align: center;">:—–:</td>
</tr>
<tr class="even">
<td style="text-align: left;">Excel 2007+ XML Formats (XLSX/XLSM)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;">:o:</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Excel 2007+ Binary Format (XLSB BIFF12)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;">:o:</td>
</tr>
<tr class="even">
<td style="text-align: left;">Excel 2003-2004 XML Format (XML “SpreadsheetML”)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Excel 97-2004 (XLS BIFF8)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Excel 5.0/95 (XLS BIFF5)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Excel 4.0 (XLS/XLW BIFF4)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Excel 3.0 (XLS BIFF3)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Excel 2.0/2.1 (XLS BIFF2)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;">:o:</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Excel Supported Text Formats</strong></td>
<td style="text-align: center;">:—–:</td>
<td style="text-align: center;">:—–:</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Delimiter-Separated Values (CSV/TSV/DSV)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">:o:</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Other Workbook/Worksheet Formats</strong></td>
<td style="text-align: center;">:—–:</td>
<td style="text-align: center;">:—–:</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OpenDocument Spreadsheet (ODS)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;">:o:</td>
</tr>
<tr class="even">
<td style="text-align: left;">Flat XML ODF Spreadsheet (FODS)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;">:o:</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Uniform Office Format Spreadsheet (标文通 UOS1/UOS2)</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Other Common Spreadsheet Output Formats</strong></td>
<td style="text-align: center;">:—–:</td>
<td style="text-align: center;">:—–:</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HTML Tables</td>
<td style="text-align: center;">:o:</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>Demo: <a href="http://oss.sheetjs.com/js-xlsx" class="uri">http://oss.sheetjs.com/js-xlsx</a></p>
<p>Source: <a href="http://git.io/xlsx" class="uri">http://git.io/xlsx</a></p>
<p>Paid support available through the <a href="http://sheetjs.com/reinforcements">reinforcements program</a></p>
<h2 id="installation">Installation</h2>
<p>With <a href="https://www.npmjs.org/package/xlsx">npm</a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">$ <span class="ex">npm</span> install xlsx</a></code></pre></div>
<p>In the browser:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;script</span><span class="ot"> lang=</span><span class="st">&quot;javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;dist/xlsx.core.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<p>With <a href="http://bower.io/search/?q=js-xlsx">bower</a>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1">$ <span class="ex">bower</span> install js-xlsx</a></code></pre></div>
<p>CDNjs automatically pulls the latest version and makes all versions available at <a href="http://cdnjs.com/libraries/xlsx" class="uri">http://cdnjs.com/libraries/xlsx</a></p>
<h3 id="optional-modules">Optional Modules</h3>
<p>The node version automatically requires modules for additional features. Some of these modules are rather large in size and are only needed in special circumstances, so they do not ship with the core. For browser use, they must be included directly:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb4-1" title="1"><span class="co">&lt;!-- international support from js-codepage --&gt;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;dist/cpexcel.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">&lt;!-- ODS support --&gt;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;dist/ods.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<p>An appropriate version for each dependency is included in the dist/ directory.</p>
<p>The complete single-file version is generated at <code>dist/xlsx.full.min.js</code></p>
<h3 id="js-ecosystem-demos">JS Ecosystem Demos</h3>
<p>The <code>demos</code> directory includes sample projects for:</p>
<ul>
<li><a href="http://browserify.org/"><code>browserify</code></a></li>
<li><a href="http://requirejs.org/"><code>requirejs</code></a></li>
<li><a href="https://webpack.js.org/"><code>webpack</code></a></li>
</ul>
<h3 id="ecmascript-5-compatibility">ECMAScript 5 Compatibility</h3>
<p>Since xlsx.js uses ES5 functions like <code>Array#forEach</code>, older browsers require <a href="http://git.io/QVh77g">Polyfills</a>. This repo and the gh-pages branch include <a href="https://github.com/SheetJS/js-xlsx/blob/master/shim.js">a shim</a></p>
<p>To use the shim, add the shim before the script tag that loads xlsx.js:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> src=</span><span class="st">&quot;/path/to/shim.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<h2 id="parsing-workbooks">Parsing Workbooks</h2>
<p>For parsing, the first step is to read the file. This involves acquiring the data and feeding it into the library. Here are a few common scenarios:</p>
<ul>
<li>node readFile:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="cf">if</span>(<span class="kw">typeof</span> require <span class="op">!==</span> <span class="st">&#39;undefined&#39;</span>) XLSX <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;xlsx&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">var</span> workbook <span class="op">=</span> <span class="va">XLSX</span>.<span class="at">readFile</span>(<span class="st">&#39;test.xlsx&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">/* DO SOMETHING WITH workbook HERE */</span></a></code></pre></div>
<ul>
<li>ajax (for a more complete example that works in older browsers, check the demo at <a href="http://oss.sheetjs.com/js-xlsx/ajax.html" class="uri">http://oss.sheetjs.com/js-xlsx/ajax.html</a>):</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="co">/* set up XMLHttpRequest */</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">var</span> url <span class="op">=</span> <span class="st">&quot;test_files/formula_stress_test_ajax.xlsx&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">var</span> oReq <span class="op">=</span> <span class="kw">new</span> <span class="at">XMLHttpRequest</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="va">oReq</span>.<span class="at">open</span>(<span class="st">&quot;GET&quot;</span><span class="op">,</span> url<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="va">oReq</span>.<span class="at">responseType</span> <span class="op">=</span> <span class="st">&quot;arraybuffer&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="va">oReq</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="kw">var</span> arraybuffer <span class="op">=</span> <span class="va">oReq</span>.<span class="at">response</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10">  <span class="co">/* convert data to binary string */</span></a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="kw">var</span> data <span class="op">=</span> <span class="kw">new</span> <span class="at">Uint8Array</span>(arraybuffer)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-12" title="12">  <span class="kw">var</span> arr <span class="op">=</span> <span class="kw">new</span> <span class="at">Array</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-13" title="13">  <span class="cf">for</span>(<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">!=</span> <span class="va">data</span>.<span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) arr[i] <span class="op">=</span> <span class="va">String</span>.<span class="at">fromCharCode</span>(data[i])<span class="op">;</span></a>
<a class="sourceLine" id="cb7-14" title="14">  <span class="kw">var</span> bstr <span class="op">=</span> <span class="va">arr</span>.<span class="at">join</span>(<span class="st">&quot;&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-15" title="15"></a>
<a class="sourceLine" id="cb7-16" title="16">  <span class="co">/* Call XLSX */</span></a>
<a class="sourceLine" id="cb7-17" title="17">  <span class="kw">var</span> workbook <span class="op">=</span> <span class="va">XLSX</span>.<span class="at">read</span>(bstr<span class="op">,</span> <span class="op">{</span><span class="dt">type</span><span class="op">:</span><span class="st">&quot;binary&quot;</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-18" title="18"></a>
<a class="sourceLine" id="cb7-19" title="19">  <span class="co">/* DO SOMETHING WITH workbook HERE */</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="op">}</span></a>
<a class="sourceLine" id="cb7-21" title="21"></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="va">oReq</span>.<span class="at">send</span>()<span class="op">;</span></a></code></pre></div>
<ul>
<li>HTML5 drag-and-drop using readAsBinaryString or readAsArrayBuffer: note: readAsBinaryString and readAsArrayBuffer may not be available in every browser. Use dynamic feature tests to determine which method to use.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="co">/* processing array buffers, only required for readAsArrayBuffer */</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">function</span> <span class="at">fixdata</span>(data) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-3" title="3">    <span class="kw">var</span> o <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">,</span> l <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> w <span class="op">=</span> <span class="dv">10240</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-4" title="4">    <span class="cf">for</span>(<span class="op">;</span> l<span class="op">&lt;</span><span class="va">data</span>.<span class="at">byteLength</span>/w<span class="op">;</span> <span class="op">++</span>l) o<span class="op">+=</span><span class="va">String</span>.<span class="va">fromCharCode</span>.<span class="at">apply</span>(<span class="kw">null</span><span class="op">,</span><span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="va">data</span>.<span class="at">slice</span>(l<span class="op">*</span>w<span class="op">,</span>l<span class="op">*</span>w<span class="op">+</span>w)))<span class="op">;</span></a>
<a class="sourceLine" id="cb8-5" title="5">    o<span class="op">+=</span><span class="va">String</span>.<span class="va">fromCharCode</span>.<span class="at">apply</span>(<span class="kw">null</span><span class="op">,</span> <span class="kw">new</span> <span class="at">Uint8Array</span>(<span class="va">data</span>.<span class="at">slice</span>(l<span class="op">*</span>w)))<span class="op">;</span></a>
<a class="sourceLine" id="cb8-6" title="6">    <span class="cf">return</span> o<span class="op">;</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="kw">var</span> rABS <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> <span class="co">// true: readAsBinaryString ; false: readAsArrayBuffer</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">/* set up drag-and-drop event */</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="kw">function</span> <span class="at">handleDrop</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-12" title="12">  <span class="va">e</span>.<span class="at">stopPropagation</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-13" title="13">  <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-14" title="14">  <span class="kw">var</span> files <span class="op">=</span> <span class="va">e</span>.<span class="va">dataTransfer</span>.<span class="at">files</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="kw">var</span> i<span class="op">,</span>f<span class="op">;</span></a>
<a class="sourceLine" id="cb8-16" title="16">  <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">!=</span> <span class="va">files</span>.<span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-17" title="17">    f <span class="op">=</span> files[i]<span class="op">;</span></a>
<a class="sourceLine" id="cb8-18" title="18">    <span class="kw">var</span> reader <span class="op">=</span> <span class="kw">new</span> <span class="at">FileReader</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-19" title="19">    <span class="kw">var</span> name <span class="op">=</span> <span class="va">f</span>.<span class="at">name</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-20" title="20">    <span class="va">reader</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-21" title="21">      <span class="kw">var</span> data <span class="op">=</span> <span class="va">e</span>.<span class="va">target</span>.<span class="at">result</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-22" title="22"></a>
<a class="sourceLine" id="cb8-23" title="23">      <span class="kw">var</span> workbook<span class="op">;</span></a>
<a class="sourceLine" id="cb8-24" title="24">      <span class="cf">if</span>(rABS) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-25" title="25">        <span class="co">/* if binary string, read with type &#39;binary&#39; */</span></a>
<a class="sourceLine" id="cb8-26" title="26">        workbook <span class="op">=</span> <span class="va">XLSX</span>.<span class="at">read</span>(data<span class="op">,</span> <span class="op">{</span><span class="dt">type</span><span class="op">:</span> <span class="st">&#39;binary&#39;</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-27" title="27">      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb8-28" title="28">        <span class="co">/* if array buffer, convert to base64 */</span></a>
<a class="sourceLine" id="cb8-29" title="29">        <span class="kw">var</span> arr <span class="op">=</span> <span class="at">fixdata</span>(data)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-30" title="30">        workbook <span class="op">=</span> <span class="va">XLSX</span>.<span class="at">read</span>(<span class="at">btoa</span>(arr)<span class="op">,</span> <span class="op">{</span><span class="dt">type</span><span class="op">:</span> <span class="st">&#39;base64&#39;</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-31" title="31">      <span class="op">}</span></a>
<a class="sourceLine" id="cb8-32" title="32"></a>
<a class="sourceLine" id="cb8-33" title="33">      <span class="co">/* DO SOMETHING WITH workbook HERE */</span></a>
<a class="sourceLine" id="cb8-34" title="34">    <span class="op">};</span></a>
<a class="sourceLine" id="cb8-35" title="35">    <span class="cf">if</span>(rABS) <span class="va">reader</span>.<span class="at">readAsBinaryString</span>(f)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-36" title="36">    <span class="cf">else</span> <span class="va">reader</span>.<span class="at">readAsArrayBuffer</span>(f)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-37" title="37">  <span class="op">}</span></a>
<a class="sourceLine" id="cb8-38" title="38"><span class="op">}</span></a>
<a class="sourceLine" id="cb8-39" title="39"><span class="va">drop_dom_element</span>.<span class="at">addEventListener</span>(<span class="st">&#39;drop&#39;</span><span class="op">,</span> handleDrop<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre></div>
<ul>
<li>HTML5 input file element using readAsBinaryString or readAsArrayBuffer:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="co">/* fixdata and rABS are defined in the drag and drop example */</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">function</span> <span class="at">handleFile</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="kw">var</span> files <span class="op">=</span> <span class="va">e</span>.<span class="va">target</span>.<span class="at">files</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="kw">var</span> i<span class="op">,</span>f<span class="op">;</span></a>
<a class="sourceLine" id="cb9-5" title="5">  <span class="cf">for</span> (i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">!=</span> <span class="va">files</span>.<span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-6" title="6">    f <span class="op">=</span> files[i]<span class="op">;</span></a>
<a class="sourceLine" id="cb9-7" title="7">    <span class="kw">var</span> reader <span class="op">=</span> <span class="kw">new</span> <span class="at">FileReader</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb9-8" title="8">    <span class="kw">var</span> name <span class="op">=</span> <span class="va">f</span>.<span class="at">name</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-9" title="9">    <span class="va">reader</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-10" title="10">      <span class="kw">var</span> data <span class="op">=</span> <span class="va">e</span>.<span class="va">target</span>.<span class="at">result</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-11" title="11"></a>
<a class="sourceLine" id="cb9-12" title="12">      <span class="kw">var</span> workbook<span class="op">;</span></a>
<a class="sourceLine" id="cb9-13" title="13">      <span class="cf">if</span>(rABS) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-14" title="14">        <span class="co">/* if binary string, read with type &#39;binary&#39; */</span></a>
<a class="sourceLine" id="cb9-15" title="15">        workbook <span class="op">=</span> <span class="va">XLSX</span>.<span class="at">read</span>(data<span class="op">,</span> <span class="op">{</span><span class="dt">type</span><span class="op">:</span> <span class="st">&#39;binary&#39;</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-16" title="16">      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb9-17" title="17">        <span class="co">/* if array buffer, convert to base64 */</span></a>
<a class="sourceLine" id="cb9-18" title="18">        <span class="kw">var</span> arr <span class="op">=</span> <span class="at">fixdata</span>(data)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-19" title="19">        workbook <span class="op">=</span> <span class="va">XLSX</span>.<span class="at">read</span>(<span class="at">btoa</span>(arr)<span class="op">,</span> <span class="op">{</span><span class="dt">type</span><span class="op">:</span> <span class="st">&#39;base64&#39;</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-20" title="20">      <span class="op">}</span></a>
<a class="sourceLine" id="cb9-21" title="21"></a>
<a class="sourceLine" id="cb9-22" title="22">      <span class="co">/* DO SOMETHING WITH workbook HERE */</span></a>
<a class="sourceLine" id="cb9-23" title="23">    <span class="op">};</span></a>
<a class="sourceLine" id="cb9-24" title="24">    <span class="va">reader</span>.<span class="at">readAsBinaryString</span>(f)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-25" title="25">  <span class="op">}</span></a>
<a class="sourceLine" id="cb9-26" title="26"><span class="op">}</span></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="va">input_dom_element</span>.<span class="at">addEventListener</span>(<span class="st">&#39;change&#39;</span><span class="op">,</span> handleFile<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre></div>
<h2 id="working-with-the-workbook">Working with the Workbook</h2>
<p>The full object format is described later in this README.</p>
<p>This example extracts the value stored in cell A1 from the first worksheet:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">var</span> first_sheet_name <span class="op">=</span> <span class="va">workbook</span>.<span class="at">SheetNames</span>[<span class="dv">0</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">var</span> address_of_cell <span class="op">=</span> <span class="st">&#39;A1&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">/* Get worksheet */</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">var</span> worksheet <span class="op">=</span> <span class="va">workbook</span>.<span class="at">Sheets</span>[first_sheet_name]<span class="op">;</span></a>
<a class="sourceLine" id="cb10-6" title="6"></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">/* Find desired cell */</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="kw">var</span> desired_cell <span class="op">=</span> worksheet[address_of_cell]<span class="op">;</span></a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">/* Get the value */</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="kw">var</span> desired_value <span class="op">=</span> <span class="va">desired_cell</span>.<span class="at">v</span><span class="op">;</span></a></code></pre></div>
<p>This example iterates through every nonempty of every sheet and dumps values:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">var</span> sheet_name_list <span class="op">=</span> <span class="va">workbook</span>.<span class="at">SheetNames</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="va">sheet_name_list</span>.<span class="at">forEach</span>(<span class="kw">function</span>(y) <span class="op">{</span> <span class="co">/* iterate through sheets */</span></a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="kw">var</span> worksheet <span class="op">=</span> <span class="va">workbook</span>.<span class="at">Sheets</span>[y]<span class="op">;</span></a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="cf">for</span> (<span class="kw">var</span> z <span class="kw">in</span> worksheet) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="co">/* all keys that do not begin with &quot;!&quot; correspond to cell addresses */</span></a>
<a class="sourceLine" id="cb11-6" title="6">    <span class="cf">if</span>(z[<span class="dv">0</span>] <span class="op">===</span> <span class="st">&#39;!&#39;</span>) <span class="cf">continue</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7">    <span class="va">console</span>.<span class="at">log</span>(y <span class="op">+</span> <span class="st">&quot;!&quot;</span> <span class="op">+</span> z <span class="op">+</span> <span class="st">&quot;=&quot;</span> <span class="op">+</span> <span class="va">JSON</span>.<span class="at">stringify</span>(worksheet[z].<span class="at">v</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="op">}</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Complete examples:</p>
<ul>
<li><a href="http://oss.sheetjs.com/js-xlsx/" class="uri">http://oss.sheetjs.com/js-xlsx/</a> HTML5 File API / Base64 Text / Web Workers</li>
</ul>
<p>Note that older versions of IE do not support HTML5 File API, so the base64 mode is used for testing. On OSX you can get the base64 encoding with:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1">$ <span class="op">&lt;</span><span class="ex">target_file</span> base64 <span class="kw">|</span> <span class="ex">pbcopy</span></a></code></pre></div>
<p>On Windows XP and up you can get the base64 encoding using <code>certutil</code>:</p>
<pre class="cmd"><code>&gt; certutil -encode target_file target_file.b64</code></pre>
<p>(note: You have to open the file and remove the header and footer lines)</p>
<ul>
<li><p><a href="http://oss.sheetjs.com/js-xlsx/ajax.html" class="uri">http://oss.sheetjs.com/js-xlsx/ajax.html</a> XMLHttpRequest</p></li>
<li><p><a href="https://github.com/SheetJS/js-xlsx/blob/master/bin/xlsx.njs" class="uri">https://github.com/SheetJS/js-xlsx/blob/master/bin/xlsx.njs</a> node</p></li>
</ul>
<p>The node version installs a command line tool <code>xlsx</code> which can read spreadsheet files and output the contents in various formats. The source is available at <code>xlsx.njs</code> in the bin directory.</p>
<p>Some helper functions in <code>XLSX.utils</code> generate different views of the sheets:</p>
<ul>
<li><code>XLSX.utils.sheet_to_csv</code> generates CSV</li>
<li><code>XLSX.utils.sheet_to_json</code> generates an array of objects</li>
<li><code>XLSX.utils.sheet_to_formulae</code> generates a list of formulae</li>
</ul>
<h2 id="writing-workbooks">Writing Workbooks</h2>
<p>For writing, the first step is to generate output data. The helper functions <code>write</code> and <code>writeFile</code> will produce the data in various formats suitable for dissemination. The second step is to actual share the data with the end point. Assuming <code>workbook</code> is a workbook object:</p>
<ul>
<li>nodejs write to file:</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="co">/* output format determined by filename */</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="va">XLSX</span>.<span class="at">writeFile</span>(workbook<span class="op">,</span> <span class="st">&#39;out.xlsx&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co">/* at this point, out.xlsx is a file that you can distribute */</span></a></code></pre></div>
<ul>
<li>browser generate binary blob and “download” to client (using <a href="https://github.com/eligrey/FileSaver.js/">FileSaver.js</a> for download):</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="co">/* bookType can be &#39;xlsx&#39; or &#39;xlsm&#39; or &#39;xlsb&#39; or &#39;ods&#39; */</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">var</span> wopts <span class="op">=</span> <span class="op">{</span> <span class="dt">bookType</span><span class="op">:</span><span class="st">&#39;xlsx&#39;</span><span class="op">,</span> <span class="dt">bookSST</span><span class="op">:</span><span class="kw">false</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span><span class="st">&#39;binary&#39;</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb15-3" title="3"></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="kw">var</span> wbout <span class="op">=</span> <span class="va">XLSX</span>.<span class="at">write</span>(workbook<span class="op">,</span>wopts)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="kw">function</span> <span class="at">s2ab</span>(s) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-7" title="7">  <span class="kw">var</span> buf <span class="op">=</span> <span class="kw">new</span> <span class="at">ArrayBuffer</span>(<span class="va">s</span>.<span class="at">length</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-8" title="8">  <span class="kw">var</span> view <span class="op">=</span> <span class="kw">new</span> <span class="at">Uint8Array</span>(buf)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-9" title="9">  <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">!=</span><span class="va">s</span>.<span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) view[i] <span class="op">=</span> <span class="va">s</span>.<span class="at">charCodeAt</span>(i) <span class="op">&amp;</span> <span class="bn">0xFF</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-10" title="10">  <span class="cf">return</span> buf<span class="op">;</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="op">}</span></a>
<a class="sourceLine" id="cb15-12" title="12"></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="co">/* the saveAs call downloads a file on the local machine */</span></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="at">saveAs</span>(<span class="kw">new</span> <span class="at">Blob</span>([<span class="at">s2ab</span>(wbout)]<span class="op">,{</span><span class="dt">type</span><span class="op">:</span><span class="st">&quot;application/octet-stream&quot;</span><span class="op">}</span>)<span class="op">,</span> <span class="st">&quot;test.xlsx&quot;</span>)<span class="op">;</span></a></code></pre></div>
<p>Complete examples:</p>
<ul>
<li><a href="http://sheetjs.com/demos/writexlsx.html" class="uri">http://sheetjs.com/demos/writexlsx.html</a> generates a simple file</li>
<li><a href="http://git.io/WEK88Q" class="uri">http://git.io/WEK88Q</a> writing an array of arrays in nodejs</li>
<li><a href="http://sheetjs.com/demos/table.html" class="uri">http://sheetjs.com/demos/table.html</a> exporting an HTML table</li>
</ul>
<h2 id="interface">Interface</h2>
<p><code>XLSX</code> is the exposed variable in the browser and the exported node variable</p>
<p><code>XLSX.version</code> is the version of the library (added by the build script).</p>
<p><code>XLSX.SSF</code> is an embedded version of the <a href="http://git.io/ssf">format library</a>.</p>
<h3 id="parsing-functions">Parsing functions</h3>
<p><code>XLSX.read(data, read_opts)</code> attempts to parse <code>data</code>.</p>
<p><code>XLSX.readFile(filename, read_opts)</code> attempts to read <code>filename</code> and parse.</p>
<h3 id="writing-functions">Writing functions</h3>
<p><code>XLSX.write(wb, write_opts)</code> attempts to write the workbook <code>wb</code></p>
<p><code>XLSX.writeFile(wb, filename, write_opts)</code> attempts to write <code>wb</code> to <code>filename</code></p>
<h3 id="utilities">Utilities</h3>
<p>Utilities are available in the <code>XLSX.utils</code> object:</p>
<p>Exporting:</p>
<ul>
<li><code>sheet_to_json</code> converts a worksheet object to an array of JSON objects. <code>sheet_to_row_object_array</code> is an alias that will be removed in the future.</li>
<li><code>sheet_to_csv</code> generates delimiter-separated-values output.</li>
<li><code>sheet_to_formulae</code> generates a list of the formulae (with value fallbacks).</li>
</ul>
<p>The <code>sheet_to_*</code> functions accept a worksheet and an optional options object.</p>
<p>Cell and cell address manipulation:</p>
<ul>
<li><code>format_cell</code> generates the text value for a cell (using number formats)</li>
<li><code>{en,de}code_{row,col}</code> convert between 0-indexed rows/cols and A1 forms.</li>
<li><code>{en,de}code_cell</code> converts cell addresses</li>
<li><code>{en,de}code_range</code> converts cell ranges</li>
</ul>
<h2 id="workbook-worksheet-cell-object-description">Workbook / Worksheet / Cell Object Description</h2>
<p>js-xlsx conforms to the Common Spreadsheet Format (CSF):</p>
<h3 id="general-structures">General Structures</h3>
<p>Cell address objects are stored as <code>{c:C, r:R}</code> where <code>C</code> and <code>R</code> are 0-indexed column and row numbers, respectively. For example, the cell address <code>B5</code> is represented by the object <code>{c:1, r:4}</code>.</p>
<p>Cell range objects are stored as <code>{s:S, e:E}</code> where <code>S</code> is the first cell and <code>E</code> is the last cell in the range. The ranges are inclusive. For example, the range <code>A3:B7</code> is represented by the object <code>{s:{c:0, r:2}, e:{c:1, r:6}}</code>. Utils use the following pattern to walk each of the cells in a range:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="cf">for</span>(<span class="kw">var</span> R <span class="op">=</span> <span class="va">range</span>.<span class="va">s</span>.<span class="at">r</span><span class="op">;</span> R <span class="op">&lt;=</span> <span class="va">range</span>.<span class="va">e</span>.<span class="at">r</span><span class="op">;</span> <span class="op">++</span>R) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="cf">for</span>(<span class="kw">var</span> C <span class="op">=</span> <span class="va">range</span>.<span class="va">s</span>.<span class="at">c</span><span class="op">;</span> C <span class="op">&lt;=</span> <span class="va">range</span>.<span class="va">e</span>.<span class="at">c</span><span class="op">;</span> <span class="op">++</span>C) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-3" title="3">    <span class="kw">var</span> cell_address <span class="op">=</span> <span class="op">{</span><span class="dt">c</span><span class="op">:</span>C<span class="op">,</span> <span class="dt">r</span><span class="op">:</span>R<span class="op">};</span></a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="op">}</span></a></code></pre></div>
<h3 id="cell-object">Cell Object</h3>
<table>
<thead>
<tr class="header">
<th>Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>v</code></td>
<td>raw value (see Data Types section for more info)</td>
</tr>
<tr class="even">
<td><code>w</code></td>
<td>formatted text (if applicable)</td>
</tr>
<tr class="odd">
<td><code>t</code></td>
<td>cell type: <code>b</code> Boolean, <code>n</code> Number, <code>e</code> error, <code>s</code> String, <code>d</code> Date</td>
</tr>
<tr class="even">
<td><code>f</code></td>
<td>cell formula encoded as an A1-style string (if applicable)</td>
</tr>
<tr class="odd">
<td><code>F</code></td>
<td>range of enclosing array if formula is array formula (if applicable)</td>
</tr>
<tr class="even">
<td><code>r</code></td>
<td>rich text encoding (if applicable)</td>
</tr>
<tr class="odd">
<td><code>h</code></td>
<td>HTML rendering of the rich text (if applicable)</td>
</tr>
<tr class="even">
<td><code>c</code></td>
<td>comments associated with the cell</td>
</tr>
<tr class="odd">
<td><code>z</code></td>
<td>number format string associated with the cell (if requested)</td>
</tr>
<tr class="even">
<td><code>l</code></td>
<td>cell hyperlink object (.Target holds link, .tooltip is tooltip)</td>
</tr>
<tr class="odd">
<td><code>s</code></td>
<td>the style/theme of the cell (if applicable)</td>
</tr>
</tbody>
</table>
<p>Built-in export utilities (such as the CSV exporter) will use the <code>w</code> text if it is available. To change a value, be sure to delete <code>cell.w</code> (or set it to <code>undefined</code>) before attempting to export. The utilities will regenerate the <code>w</code> text from the number format (<code>cell.z</code>) and the raw value if possible.</p>
<p>The actual array formula is stored in the <code>f</code> field of the first cell in the array range. Other cells in the range will omit the <code>f</code> field.</p>
<h3 id="data-types">Data Types</h3>
<p>The raw value is stored in the <code>v</code> field, interpreted based on the <code>t</code> field.</p>
<p>Type <code>b</code> is the Boolean type. <code>v</code> is interpreted according to JS truth tables</p>
<p>Type <code>e</code> is the Error type. <code>v</code> holds the number and <code>w</code> holds the common name:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">Value</th>
<th style="text-align: left;">Error Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0x00</td>
<td style="text-align: left;">#NULL!</td>
</tr>
<tr class="even">
<td style="text-align: right;">0x07</td>
<td style="text-align: left;">#DIV/0!</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0x0F</td>
<td style="text-align: left;">#VALUE!</td>
</tr>
<tr class="even">
<td style="text-align: right;">0x17</td>
<td style="text-align: left;">#REF!</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0x1D</td>
<td style="text-align: left;">#NAME?</td>
</tr>
<tr class="even">
<td style="text-align: right;">0x24</td>
<td style="text-align: left;">#NUM!</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0x2A</td>
<td style="text-align: left;">#N/A</td>
</tr>
<tr class="even">
<td style="text-align: right;">0x2B</td>
<td style="text-align: left;">#GETTING_DATA</td>
</tr>
</tbody>
</table>
<p>Type <code>n</code> is the Number type. This includes all forms of data that Excel stores as numbers, such as dates/times and Boolean fields. Excel exclusively uses data that can be fit in an IEEE754 floating point number, just like JS Number, so the <code>v</code> field holds the raw number. The <code>w</code> field holds formatted text.</p>
<p>Type <code>d</code> is the Date type, generated only when the option <code>cellDates</code> is passed. Since JSON does not have a natural Date type, parsers are generally expected to store ISO 8601 Date strings like you would get from <code>date.toISOString()</code>. On the other hand, writers and exporters should be able to handle date strings and JS Date objects. Note that Excel disregards timezone modifiers and treats all dates in the local timezone. js-xlsx does not correct for this error.</p>
<p>Type <code>s</code> is the String type. <code>v</code> should be explicitly stored as a string to avoid possible confusion.</p>
<h3 id="formulae">Formulae</h3>
<p>The A1-style formula string is stored in the <code>f</code> field. Even though different file formats store the formulae in different ways, the formats are converted.</p>
<p>Shared formulae are decompressed and each cell has the correct formula.</p>
<p>Array formulae are stored in the top-left cell of the array block. All cells of an array formula have a <code>F</code> field corresponding to the range. A single-cell formula can be distinguished from a plain formula by the presence of <code>F</code> field.</p>
<p>The <code>sheet_to_formulae</code> method generates one line per formula or array formula. Array formulae are rendered in the form <code>range=formula</code> while plain cells are rendered in the form <code>cell=formula or value</code>.</p>
<h3 id="worksheet-object">Worksheet Object</h3>
<p>Each key that does not start with <code>!</code> maps to a cell (using <code>A-1</code> notation)</p>
<p><code>worksheet[address]</code> returns the cell object for the specified address.</p>
<p>Special worksheet keys (accessible as <code>worksheet[key]</code>, each starting with <code>!</code>):</p>
<ul>
<li><p><code>ws['!ref']</code>: A-1 based range representing the worksheet range. Functions that work with sheets should use this parameter to determine the range. Cells that are assigned outside of the range are not processed. In particular, when writing a worksheet by hand, be sure to update the range. For a longer discussion, see <a href="http://git.io/KIaNKQ" class="uri">http://git.io/KIaNKQ</a></p>
<p>Functions that handle worksheets should test for the presence of <code>!ref</code> field. If the <code>!ref</code> is omitted or is not a valid range, functions are free to treat the sheet as empty or attempt to guess the range. The standard utilities that ship with this library treat sheets as empty (for example, the CSV output is empty string).</p>
<p>When reading a worksheet with the <code>sheetRows</code> property set, the ref parameter will use the restricted range. The original range is set at <code>ws['!fullref']</code></p></li>
<li><p><code>ws['!cols']</code>: array of column properties objects. Column widths are actually stored in files in a normalized manner, measured in terms of the “Maximum Digit Width” (the largest width of the rendered digits 0-9, in pixels). When parsed, the column objects store the pixel width in the <code>wpx</code> field, character width in the <code>wch</code> field, and the maximum digit width in the <code>MDW</code> field.</p></li>
<li><p><code>ws['!merges']</code>: array of range objects corresponding to the merged cells in the worksheet. Plaintext utilities are unaware of merge cells. CSV export will write all cells in the merge range if they exist, so be sure that only the first cell (upper-left) in the range is set.</p></li>
</ul>
<h3 id="workbook-object">Workbook Object</h3>
<p><code>workbook.SheetNames</code> is an ordered list of the sheets in the workbook</p>
<p><code>wb.Sheets[sheetname]</code> returns an object representing the worksheet.</p>
<p><code>wb.Props</code> is an object storing the standard properties. <code>wb.Custprops</code> stores custom properties. Since the XLS standard properties deviate from the XLSX standard, XLS parsing stores core properties in both places. .</p>
<h2 id="parsing-options">Parsing Options</h2>
<p>The exported <code>read</code> and <code>readFile</code> functions accept an options argument:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Option Name</th>
<th style="text-align: right;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">type</td>
<td style="text-align: right;"></td>
<td style="text-align: left;">Input data encoding (see Input Type below)</td>
</tr>
<tr class="even">
<td style="text-align: left;">cellFormula</td>
<td style="text-align: right;">true</td>
<td style="text-align: left;">Save formulae to the .f field **</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cellHTML</td>
<td style="text-align: right;">true</td>
<td style="text-align: left;">Parse rich text and save HTML to the .h field</td>
</tr>
<tr class="even">
<td style="text-align: left;">cellNF</td>
<td style="text-align: right;">false</td>
<td style="text-align: left;">Save number format string to the .z field</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cellStyles</td>
<td style="text-align: right;">false</td>
<td style="text-align: left;">Save style/theme info to the .s field</td>
</tr>
<tr class="even">
<td style="text-align: left;">cellDates</td>
<td style="text-align: right;">false</td>
<td style="text-align: left;">Store dates as type <code>d</code> (default is <code>n</code>) **</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sheetStubs</td>
<td style="text-align: right;">false</td>
<td style="text-align: left;">Create cell objects for stub cells</td>
</tr>
<tr class="even">
<td style="text-align: left;">sheetRows</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">If &gt;0, read the first <code>sheetRows</code> rows **</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bookDeps</td>
<td style="text-align: right;">false</td>
<td style="text-align: left;">If true, parse calculation chains</td>
</tr>
<tr class="even">
<td style="text-align: left;">bookFiles</td>
<td style="text-align: right;">false</td>
<td style="text-align: left;">If true, add raw files to book object **</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bookProps</td>
<td style="text-align: right;">false</td>
<td style="text-align: left;">If true, only parse enough to get book metadata **</td>
</tr>
<tr class="even">
<td style="text-align: left;">bookSheets</td>
<td style="text-align: right;">false</td>
<td style="text-align: left;">If true, only parse enough to get the sheet names</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bookVBA</td>
<td style="text-align: right;">false</td>
<td style="text-align: left;">If true, expose vbaProject.bin to <code>vbaraw</code> field **</td>
</tr>
<tr class="even">
<td style="text-align: left;">password</td>
<td style="text-align: right;">""</td>
<td style="text-align: left;">If defined and file is encrypted, use password **</td>
</tr>
</tbody>
</table>
<ul>
<li><code>cellFormula</code> option only applies to formats that require extra processing to parse formulae (XLS/XLSB).</li>
<li>Even if <code>cellNF</code> is false, formatted text will be generated and saved to <code>.w</code></li>
<li>In some cases, sheets may be parsed even if <code>bookSheets</code> is false.</li>
<li><code>bookSheets</code> and <code>bookProps</code> combine to give both sets of information</li>
<li><code>Deps</code> will be an empty object if <code>bookDeps</code> is falsy</li>
<li><code>bookFiles</code> behavior depends on file type:
<ul>
<li><code>keys</code> array (paths in the ZIP) for ZIP-based formats</li>
<li><code>files</code> hash (mapping paths to objects representing the files) for ZIP</li>
<li><code>cfb</code> object for formats using CFB containers</li>
</ul></li>
<li><code>sheetRows-1</code> rows will be generated when looking at the JSON object output (since the header row is counted as a row when parsing the data)</li>
<li><code>bookVBA</code> merely exposes the raw vba object. It does not parse the data.</li>
<li><code>cellDates</code> currently does not convert numerical dates to JS dates.</li>
<li>Currently only XOR encryption is supported. Unsupported error will be thrown for files employing other encryption methods.</li>
</ul>
<p>The defaults are enumerated in bits/84_defaults.js</p>
<h3 id="input-type">Input Type</h3>
<p>Strings can be interpreted in multiple ways. The <code>type</code> parameter for <code>read</code> tells the library how to parse the data argument:</p>
<table>
<thead>
<tr class="header">
<th><code>type</code></th>
<th>expected input</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>"base64"</code></td>
<td>string: base64 encoding of the file</td>
</tr>
<tr class="even">
<td><code>"binary"</code></td>
<td>string: binary string (<code>n</code>-th byte is <code>data.charCodeAt(n)</code>)</td>
</tr>
<tr class="odd">
<td><code>"buffer"</code></td>
<td>nodejs Buffer</td>
</tr>
<tr class="even">
<td><code>"array"</code></td>
<td>array: array of 8-bit unsigned int (<code>n</code>-th byte is <code>data[n]</code>)</td>
</tr>
<tr class="odd">
<td><code>"file"</code></td>
<td>string: filename that will be read and processed (nodejs only)</td>
</tr>
</tbody>
</table>
<h3 id="guessing-file-type">Guessing File Type</h3>
<p>Excel and other spreadsheet tools read the first few bytes and apply other heuristics to determine a file type. This enables file type punning: renaming files with the <code>.xls</code> extension will tell your computer to use Excel to open the file but Excel will know how to handle it. This library applies similar logic:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Byte 0</th>
<th style="text-align: left;">Raw File Type</th>
<th style="text-align: left;">Spreadsheet Types</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>0xD0</code></td>
<td style="text-align: left;">CFB Container</td>
<td style="text-align: left;">BIFF 5/8 or password-protected XLSX/XLSB</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>0x09</code></td>
<td style="text-align: left;">BIFF Stream</td>
<td style="text-align: left;">BIFF 2/3/4/5</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>0x3C</code></td>
<td style="text-align: left;">XML/HTML</td>
<td style="text-align: left;">SpreadsheetML or Flat ODS or UOS1 or HTML</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>0x50</code></td>
<td style="text-align: left;">ZIP Archive</td>
<td style="text-align: left;">XLSB or XLSX/M or ODS or UOS2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>0xFE</code></td>
<td style="text-align: left;">UTF8 Text</td>
<td style="text-align: left;">SpreadsheetML or Flat ODS or UOS1</td>
</tr>
</tbody>
</table>
<h2 id="writing-options">Writing Options</h2>
<p>The exported <code>write</code> and <code>writeFile</code> functions accept an options argument:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Option Name</th>
<th style="text-align: right;">Default</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">type</td>
<td style="text-align: right;"></td>
<td style="text-align: left;">Output data encoding (see Output Type below)</td>
</tr>
<tr class="even">
<td style="text-align: left;">cellDates</td>
<td style="text-align: right;"><code>false</code></td>
<td style="text-align: left;">Store dates as type <code>d</code> (default is <code>n</code>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bookSST</td>
<td style="text-align: right;"><code>false</code></td>
<td style="text-align: left;">Generate Shared String Table **</td>
</tr>
<tr class="even">
<td style="text-align: left;">bookType</td>
<td style="text-align: right;"><code>"xlsx"</code></td>
<td style="text-align: left;">Type of Workbook (see below for supported formats)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sheet</td>
<td style="text-align: right;"><code>""</code></td>
<td style="text-align: left;">Name of Worksheet for single-sheet formats **</td>
</tr>
<tr class="even">
<td style="text-align: left;">compression</td>
<td style="text-align: right;"><code>false</code></td>
<td style="text-align: left;">Use ZIP compression for ZIP-based formats **</td>
</tr>
</tbody>
</table>
<ul>
<li><code>bookSST</code> is slower and more memory intensive, but has better compatibility with older versions of iOS Numbers</li>
<li>The raw data is the only thing guaranteed to be saved. Formulae, formatting, and other niceties may not be serialized (pending CSF standardization)</li>
<li><code>cellDates</code> only applies to XLSX output and is not guaranteed to work with third-party readers. Excel itself does not usually write cells with type <code>d</code> so non-Excel tools may ignore the data or blow up in the presence of dates.</li>
</ul>
<h3 id="supported-output-formats">Supported Output Formats</h3>
<p>For broad compatibility with third-party tools, this library supports many output formats. The specific file type is controlled with <code>bookType</code> option:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">bookType</th>
<th style="text-align: right;">file ext</th>
<th style="text-align: center;">container</th>
<th style="text-align: left;">sheets</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>xlsx</code></td>
<td style="text-align: right;"><code>.xlsx</code></td>
<td style="text-align: center;">ZIP</td>
<td style="text-align: left;">multi</td>
<td style="text-align: left;">Excel 2007+ XML Format</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>xlsm</code></td>
<td style="text-align: right;"><code>.xlsm</code></td>
<td style="text-align: center;">ZIP</td>
<td style="text-align: left;">multi</td>
<td style="text-align: left;">Excel 2007+ Macro XML Format</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>xlsb</code></td>
<td style="text-align: right;"><code>.xlsb</code></td>
<td style="text-align: center;">ZIP</td>
<td style="text-align: left;">multi</td>
<td style="text-align: left;">Excel 2007+ Binary Format</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ods</code></td>
<td style="text-align: right;"><code>.ods</code></td>
<td style="text-align: center;">ZIP</td>
<td style="text-align: left;">multi</td>
<td style="text-align: left;">OpenDocument Spreadsheet</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>biff2</code></td>
<td style="text-align: right;"><code>.xls</code></td>
<td style="text-align: center;">none</td>
<td style="text-align: left;">single</td>
<td style="text-align: left;">Excel 2.0 Worksheet format</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fods</code></td>
<td style="text-align: right;"><code>.fods</code></td>
<td style="text-align: center;">none</td>
<td style="text-align: left;">multi</td>
<td style="text-align: left;">Flat OpenDocument Spreadsheet</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>csv</code></td>
<td style="text-align: right;"><code>.csv</code></td>
<td style="text-align: center;">none</td>
<td style="text-align: left;">single</td>
<td style="text-align: left;">Comma Separated Values</td>
</tr>
</tbody>
</table>
<ul>
<li><code>compression</code> only applies to formats with ZIP containers.</li>
<li>Formats that only support a single sheet require a <code>sheet</code> option specifying the worksheet. If the string is empty, the first worksheet is used.</li>
</ul>
<h3 id="output-type">Output Type</h3>
<p>The <code>type</code> argument for <code>write</code> mirrors the <code>type</code> argument for <code>read</code>:</p>
<table>
<thead>
<tr class="header">
<th><code>type</code></th>
<th>output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>"base64"</code></td>
<td>string: base64 encoding of the file</td>
</tr>
<tr class="even">
<td><code>"binary"</code></td>
<td>string: binary string (<code>n</code>-th byte is <code>data.charCodeAt(n)</code>)</td>
</tr>
<tr class="odd">
<td><code>"buffer"</code></td>
<td>nodejs Buffer</td>
</tr>
<tr class="even">
<td><code>"file"</code></td>
<td>string: name of file to be written (nodejs only)</td>
</tr>
</tbody>
</table>
<h2 id="file-formats">File Formats</h2>
<p>Despite the fact that the name of the library is <code>xlsx</code>, it supports numerous non-XLSX file formats:</p>
<h3 id="excel-2.0-95-biff2biff3biff4biff5">Excel 2.0-95 (BIFF2/BIFF3/BIFF4/BIFF5)</h3>
<p>BIFF 2/3 XLS are single-sheet streams of binary records. Excel 4 introduced the concept of a workbook (<code>XLW</code> files) but also had single-sheet <code>XLS</code> format. The structure is largely similar to the Lotus 1-2-3 file formats. BIFF5/8/12 extended the format in various ways but largely stuck to the same record format.</p>
<p>There is no official specification for any of these formats. Excel 95 can write files in these formats, so record lengths and fields were backsolved by writing in all of the supported formats and comparing files. Excel 2016 can generate BIFF5 files, enabling a full suite of file tests starting from XLSX or BIFF2.</p>
<h3 id="excel-97-2004-binary-biff8">Excel 97-2004 Binary (BIFF8)</h3>
<p>BIFF8 exclusively uses the Compound File Binary container format, splitting some content into streams within the file. At its core, it still uses an extended version of the binary record format from older versions of BIFF.</p>
<p>The <code>MS-XLS</code> specification covers the basics of the file format, and other specifications expand on serialization of features like properties.</p>
<h3 id="excel-2003-2004-spreadsheetml">Excel 2003-2004 (SpreadsheetML)</h3>
<p>Predating XLSX, SpreadsheetML files are simple XML files. There is no official and comprehensive specification, although MS has released whitepapers on the format. Since Excel 2016 can generate SpreadsheetML files, backsolving is pretty straightforward.</p>
<h3 id="excel-2007-binary-xlsb-biff12">Excel 2007+ Binary (XLSB, BIFF12)</h3>
<p>Introduced in parallel with XLSX, the XLSB filetype combines BIFF architecture with the content separation and ZIP container of XLSX. For the most part nodes in an XLSX sub-file can be mapped to XLSB records in a corresponding sub-file.</p>
<p>The <code>MS-XLSB</code> specification covers the basics of the file format, and other specifications expand on serialization of features like properties.</p>
<h3 id="opendocument-spreadsheet-odsfods-and-uniform-office-spreadsheet-uos12">OpenDocument Spreadsheet (ODS/FODS) and Uniform Office Spreadsheet (UOS1/2)</h3>
<p>ODS is an XML-in-ZIP format akin to XLSX while FODS is an XML format akin to SpreadsheetML. Both are detailed in the OASIS standard, but tools like LO/OO add undocumented extensions.</p>
<p>UOS is a very similar format, and it comes in 2 varieties corresponding to ODS and FODS respectively. For the most part, the difference between the formats lies in the names of tags and attributes.</p>
<h3 id="comma-separated-values">Comma-Separated Values</h3>
<p>Excel CSV deviates from RFC4180 in a number of important ways. The generated CSV files should generally work in Excel although they may not work in RFC4180 compatible readers.</p>
<h3 id="html">HTML</h3>
<p>Excel HTML worksheets include special metadata encoded in styles. For example, <code>mso-number-format</code> is a localized string containing the number format. Despite the metadata the output is valid HTML, although it does accept bare <code>&amp;</code> symbols.</p>
<h2 id="tested-environments">Tested Environments</h2>
<ul>
<li>NodeJS 0.8, 0.9, 0.10, 0.11, 0.12, 4.x, 5.x, 6.x, 7.x</li>
<li>IE 6/7/8/9/10/11 (IE6-9 browsers require shims for interacting with client)</li>
<li>Chrome 24+</li>
<li>Safari 6+</li>
<li>FF 18+</li>
</ul>
<p>Tests utilize the mocha testing framework. Travis-CI and Sauce Labs links:</p>
<ul>
<li><a href="https://travis-ci.org/SheetJS/js-xlsx" class="uri">https://travis-ci.org/SheetJS/js-xlsx</a> for XLSX module in nodejs</li>
<li><a href="https://travis-ci.org/SheetJS/SheetJS.github.io" class="uri">https://travis-ci.org/SheetJS/SheetJS.github.io</a> for XLS* modules</li>
<li><a href="https://saucelabs.com/u/sheetjs" class="uri">https://saucelabs.com/u/sheetjs</a> for XLS* modules using Sauce Labs</li>
</ul>
<h2 id="test-files">Test Files</h2>
<p>Test files are housed in <a href="https://github.com/SheetJS/test_files">another repo</a>.</p>
<p>Running <code>make init</code> will refresh the <code>test_files</code> submodule and get the files.</p>
<h2 id="testing">Testing</h2>
<p><code>make test</code> will run the node-based tests. To run the in-browser tests, clone <a href="https://github.com/SheetJS/SheetJS.github.io">the oss.sheetjs.com repo</a> and replace the xlsx.js file (then fire up the browser and go to <code>stress.html</code>):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" title="1">$ <span class="fu">cp</span> xlsx.js ../SheetJS.github.io</a>
<a class="sourceLine" id="cb17-2" title="2">$ <span class="bu">cd</span> ../SheetJS.github.io</a>
<a class="sourceLine" id="cb17-3" title="3">$ <span class="ex">simplehttpserver</span> <span class="co"># or &quot;python -mSimpleHTTPServer&quot; or &quot;serve&quot;</span></a>
<a class="sourceLine" id="cb17-4" title="4">$ <span class="ex">open</span> -a Chromium.app http://localhost:8000/stress.html</a></code></pre></div>
<p>For a much smaller test, run <code>make test_misc</code>.</p>
<h2 id="contributing">Contributing</h2>
<p>Due to the precarious nature of the Open Specifications Promise, it is very important to ensure code is cleanroom. Consult CONTRIBUTING.md</p>
<p>The xlsx.js file is constructed from the files in the <code>bits</code> subdirectory. The build script (run <code>make</code>) will concatenate the individual bits to produce the script. Before submitting a contribution, ensure that running make will produce the xlsx.js file exactly. The simplest way to test is to move the script:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" title="1">$ <span class="fu">mv</span> xlsx.js xlsx.new.js</a>
<a class="sourceLine" id="cb18-2" title="2">$ <span class="fu">make</span></a>
<a class="sourceLine" id="cb18-3" title="3">$ <span class="fu">diff</span> xlsx.js xlsx.new.js</a></code></pre></div>
<p>To produce the dist files, run <code>make dist</code>. The dist files are updated in each version release and should not be committed between versions.</p>
<h2 id="license">License</h2>
<p>Please consult the attached LICENSE file for details. All rights not explicitly granted by the Apache 2.0 License are reserved by the Original Author.</p>
<p>It is the opinion of the Original Author that this code conforms to the terms of the Microsoft Open Specifications Promise, falling under the same terms as OpenOffice (which is governed by the Apache License v2). Given the vagaries of the promise, the Original Author makes no legal claim that in fact end users are protected from future actions. It is highly recommended that, for commercial uses, you consult a lawyer before proceeding.</p>
<h2 id="references">References</h2>
<p>ISO/IEC 29500:2012(E) “Information technology — Document description and processing languages — Office Open XML File Formats”</p>
<p>OSP-covered specifications:</p>
<ul>
<li>[MS-XLSB]: Excel (.xlsb) Binary File Format</li>
<li>[MS-XLSX]: Excel (.xlsx) Extensions to the Office Open XML SpreadsheetML File Format</li>
<li></li>
<li></li>
<li>[MS-XLS]: Excel Binary File Format (.xls) Structure Specification</li>
<li></li>
<li></li>
<li>[MS-OLEDS]: Object Linking and Embedding (OLE) Data Structures</li>
<li>[MS-OLEPS]: Object Linking and Embedding (OLE) Property Set Data Structures</li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
<li></li>
</ul>
<p>Open Document Format for Office Applications Version 1.2 (29 September 2011)</p>
<h2 id="badges">Badges</h2>
<p><a href="https://saucelabs.com/u/xlsx"><img src="https://saucelabs.com/browser-matrix/xlsx.svg" alt="Build Status" /></a></p>
<p><a href="https://travis-ci.org/SheetJS/js-xlsx"><img src="https://travis-ci.org/SheetJS/js-xlsx.svg?branch=master" alt="Build Status" /></a></p>
<p><a href="https://coveralls.io/r/SheetJS/js-xlsx?branch=master"><img src="http://img.shields.io/coveralls/SheetJS/js-xlsx/master.svg" alt="Coverage Status" /></a></p>
<p><a href="https://npmjs.org/package/xlsx"><img src="https://img.shields.io/npm/dt/xlsx.svg" alt="NPM Downloads" /></a></p>
<p><a href="https://david-dm.org/sheetjs/js-xlsx"><img src="https://david-dm.org/sheetjs/js-xlsx/status.svg" alt="Dependencies Status" /></a></p>
<p><a href="https://ghit.me/repo/sheetjs/js-xlsx"><img src="https://ghit.me/badge.svg?repo=sheetjs/js-xlsx" alt="ghit.me" /></a></p>
<p><a href="https://github.com/SheetJS/js-xlsx"><img src="https://ga-beacon.appspot.com/UA-36810333-1/SheetJS/js-xlsx?pixel" alt="Analytics" /></a></p>
